(()=>{"use strict";function e(){const e={projects:n.map((e=>({title:e.title,tasks:e.tasks.map((e=>({title:e.title,description:e.description,date:e.date,priority:e.priority,completed:e.completed})))})))};localStorage.setItem("todoData",JSON.stringify(e))}class t{constructor(e){this.title=e,this.tasks=[]}addTask(e){this.tasks.push(e)}removeTask(e){this.tasks.splice(e,1)}}const n=[];function o(t,o){const i=n[t];i?(i.title=o,e()):console.error("Project not found at index:",t)}class i{constructor(e,t,n,o,i){this.title=e,this.description=t,this.date=n,this.priority=o,this.projectTitle=i,this.completed=!1}}const c=[];function r(t,o,i,c,r,d,s){console.log(`Updating task in project: ${t}, task index: ${o}`);const a=n.find((e=>e.title===t));if(!a)return void console.error("Project not found:",t);let l;if(console.log("Original project tasks before updating:",a.tasks),o>=0&&o<a.tasks.length){if(l=a.tasks[o],l.title=i,l.description=c,l.date=r,l.priority=d,console.log("Original project tasks after updating but before moving:",a.tasks),s&&s!==t){const e=n.find((e=>e.title===s));e?(a.tasks.splice(o,1),e.addTask(l),l.project=e,console.log("New project tasks:",e.tasks)):console.error("New project not found:",s)}e()}else console.error("Task not found at index:",o)}function d(t,o){const i=n.find((e=>e.title===t));if(!i)return void console.error("Project not found:",t);const c=i.tasks[o];c?(c.completed=!c.completed,e()):console.error("Task not found at index:",o)}function s(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function a(e){const t=s(e);return t.setHours(0,0,0,0),t}function l(e){return t=e,n=Date.now(),+a(t)==+a(n);var t,n}let u={};function p(){return u}function m(e,t){const n=p(),o=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,i=s(e),c=i.getDay(),r=(c<o?7:0)+c-o;return i.setDate(i.getDate()-r),i.setHours(0,0,0,0),i}function f(e,t){return function(e,t,n){return+m(e,n)==+m(t,n)}(e,Date.now(),t)}function g(e=c,t,n,o){let i=document.querySelector(".task-container");i.innerHTML="";const r=e.sort(((e,t)=>new Date(e.date)-new Date(t.date)));for(let c=0;c<r.length;c++){let s=r[c],a=document.createElement("div");a.className="task",a.dataset.index=c,s.projectTitle&&(a.dataset.projectTitle=s.projectTitle),s.completed?a.classList.add("completed"):a.classList.remove("completed"),i.appendChild(a);let l=document.createElement("i");l.id=`toggle-button-${c}`,l.className=s.completed?"fa-solid fa-circle-check":"fa-regular fa-circle",l.dataset.index=c,l.addEventListener("click",(function(i){i.stopPropagation(),d(this.closest(".task").dataset.projectTitle,this.dataset.index),g(e,t,n,o)}));let u=document.createElement("p");u.id="task-title",u.innerText=s.title;let p=document.createElement("p");p.id="task-description",p.innerText=s.description;let m=document.createElement("p");m.id="task-date",m.innerText=s.date;let f=document.createElement("p");f.id="task-priority",f.innerText=s.priority;let k=document.createElement("i");k.id=`edit-button-${c}`,k.className="fa-solid fa-pen-to-square",k.dataset.index=c,k.addEventListener("click",(function(t){t.stopPropagation();const n=this.dataset.index,o=e[n],i=document.querySelector("#edit-task-form"),c=document.querySelector("#edit-task-dialog");o?(document.querySelector("#edit-title").value=o.title,document.querySelector("#edit-description").value=o.description,document.querySelector("#edit-date").value=o.date,document.querySelector("#edit-priority-select").value=o.priority,document.querySelector("#edit-project-select").value=o.projectTitle,i.dataset.editingIndex=n,i.dataset.projectTitle=o.projectTitle,c.showModal(),c.addEventListener("click",(e=>{const t=c.getBoundingClientRect();(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&c.close()}))):console.error("Task not found at index:",n)}));let v=document.createElement("i");v.id=`remove-button-${c}`,v.className="fa-solid fa-circle-xmark",v.dataset.index=c,a.insertBefore(l,a.firstChild),a.appendChild(u),a.appendChild(p),a.appendChild(m),a.appendChild(f),a.appendChild(k),a.appendChild(v)}}function k(){return n.flatMap((e=>e.tasks))}function v(e){const t=document.querySelector(".projects-container"),n=document.querySelector("#project-select");t.innerHTML="",n.innerHTML='<option value="none">Select Project</option>',document.querySelector("#edit-project-select").innerHTML='<option value="none">Select Project</option>',e.forEach(((e,o)=>{const i=document.createElement("button");i.id=`project-button-${o}`;const c=document.createElement("p");c.textContent=e.title,c.className="project-title",i.innerHTML='<i class="fa-solid fa-list-ul"></i>',i.appendChild(c),i.addEventListener("click",(()=>{y(e.title)}));const r=document.createElement("i");r.dataset.index=o,r.id=`edit-project-button-${o}`,r.className="fa-solid fa-pen-to-square";const d=document.createElement("i");d.dataset.index=o,d.id=`remove-project-button-${o}`,d.className="fa-solid fa-circle-xmark",t.appendChild(i),i.appendChild(r),i.appendChild(d);const s=document.createElement("option");s.value=e.title,s.textContent=e.title,n.appendChild(s)}))}function y(e){const t=n.find((t=>t.title===e));let o=document.querySelector(".render-heading");t?(o.textContent=`${e}`,g(t.tasks)):console.error("Project not found:",e)}document.addEventListener("DOMContentLoaded",(()=>{const d=document.getElementById("toggle-sidebar-button"),s=document.querySelector(".left-panel"),a=document.querySelector("#task-form"),u=document.querySelector("#edit-task-form"),p=document.querySelector("#project-form"),m=document.querySelector("#add-task-button"),j=document.querySelector("#form-dialog"),h=document.querySelector("#edit-task-dialog"),S=document.querySelector("#project-dialog"),q=document.querySelector("#all-tasks-button"),x=document.querySelector("#today-button"),b=document.querySelector("#this-week-button"),E=document.querySelector("#completed-button"),T=document.querySelector("#add-project-button"),L=document.querySelector("#edit-project-dialog"),w=document.querySelector("#edit-project-form");let C=document.querySelector(".render-heading");if(function(){const e=JSON.parse(localStorage.getItem("todoData"));e&&(n.length=0,n.push(...e.projects.map((e=>{const n=new t(e.title);return n.tasks=e.tasks.map((t=>{const n=new i(t.title,t.description,t.date,t.priority,e.title);return n.completed=t.completed,n})),n}))))}(),0===n.length){const o=new t("Default");n.push(o),e()}d.addEventListener("click",(()=>{window.innerWidth<=768&&(s.classList.toggle("sidebar-hidden"),document.body.classList.toggle("sidebar-visible"))})),a.addEventListener("submit",(function(t){t.preventDefault();const o=document.querySelector("#title").value,c=document.querySelector("#description").value,d=document.querySelector("#date").value,s=document.querySelector("#priority-select").value,l=document.querySelector("#project-select").value;void 0!==a.dataset.editingIndex?(r(l,a.dataset.editingIndex,o,c,d,s,newProjectTitle),delete a.dataset.editingIndex):function(t,o,c,r,d){let s=n.find((e=>e.title===d));if(!s)return void console.error("Project not found:",d);const a=new i(t,o,c,r,d);s.addTask(a),e()}(o,c,d,s,l),y(l),a.reset(),j.close()})),u.addEventListener("submit",(function(e){e.preventDefault();const t=document.querySelector("#edit-title").value,n=document.querySelector("#edit-description").value,o=document.querySelector("#edit-date").value,i=document.querySelector("#edit-priority-select").value,c=u.dataset.projectTitle,d=document.querySelector("#edit-project-select").value;r(c,u.dataset.editingIndex,t,n,o,i,d),y(d),u.reset(),h.close(),delete u.dataset.editingIndex,delete u.dataset.projectTitle})),document.querySelector("#edit-project-select").addEventListener("change",(function(){u.dataset.projectTitle=this.value})),p.addEventListener("submit",(function(i){i.preventDefault();const c=document.querySelector("#project-title").value;void 0!==p.dataset.editingIndex?(o(p.dataset.editingIndex,c),delete p.dataset.editingIndex):function(o){const i=new t(o);n.push(i),e()}(c),v(n),p.reset(),S.close(),delete p.dataset.editingIndex})),w.addEventListener("submit",(function(e){e.preventDefault();const t=w.dataset.projectIndex,i=document.querySelector("#edit-project-title").value;void 0!==t?(o(t,i),v(n),L.close(),delete w.dataset.projectIndex):console.error("Project index not found")})),m.addEventListener("click",(()=>{j.showModal()})),j.addEventListener("click",(e=>{const t=j.getBoundingClientRect();(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&j.close()})),T.addEventListener("click",(()=>{S.showModal()})),S.addEventListener("click",(e=>{const t=S.getBoundingClientRect();(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&S.close()})),q.addEventListener("click",(()=>{const e=k();C.textContent="All Tasks",g(e,j,a,u)})),x.addEventListener("click",(()=>{C.textContent="Today's Tasks",function(e,t,n){g(k().filter((e=>l(new Date(e.date)))),e,t,n)}(j,a,u)})),b.addEventListener("click",(()=>{C.textContent="This Week's Tasks",function(e,t,n){g(k().filter((e=>f(new Date(e.date)))),e,t,n)}(j,a,u)})),E.addEventListener("click",(()=>{C.textContent="Completed Tasks",function(e,t,n){g(k().filter((e=>e.completed)),e,t,n)}(j,a,u)})),document.addEventListener("click",(function(t){if(t.target&&t.target.id.startsWith("remove-button-"))g(function(t,o){const i=n.find((e=>e.title===t));if(i)return i.tasks.splice(o,1),e(),i.tasks;console.error("Project not found:",t)}(t.target.closest(".task").dataset.projectTitle,t.target.dataset.index),j,a);else if(t.target&&t.target.id.startsWith("edit-project-button-"))L.showModal(),w.dataset.projectIndex=t.target.dataset.index,L.addEventListener("click",(e=>{const t=L.getBoundingClientRect();(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&L.close()}));else if(t.target&&t.target.id.startsWith("remove-project-button-")){const o=parseInt(t.target.dataset.index);!function(t){n.splice(t,1),e()}(o),v(n);const i=o>0?o-1:0;n.length>0?y(n[i].title):g([])}})),g(c,j,a,u),v(n)}))})();